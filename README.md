# movie-lottery

Веб-приложение для случайного фильма или сериала

## Деплой

1. Перед выкатом обновления выполните миграцию Alembic `20240228_000001_add_search_name_columns`:
   ```bash
   alembic upgrade 20240228_000001
   ```
2. Убедитесь, что миграция применена на staging- и production-базах **до** повторного деплоя обновленного кода.
3. После применения миграции и перезапуска приложения откройте страницу `/library`, чтобы убедиться в отсутствии ошибки `ProgrammingError`.

### Переменные окружения

- `PUBLIC_BASE_URL` — публичный базовый адрес (например, `https://example.com` или `http://109.110.37.194:8888`),
  который используется для формирования абсолютных ссылок в API и интерфейсе (кнопки Telegram, копирование ссылок).
  Если переменная не задана, ссылки будут строиться от текущего домена приложения.

## Проверка Kinopoisk API

Для ручного тестирования интеграции с Kinopoisk API подготовлена CLI-утилита `movie_lottery.utils.kinopoisk`.

1. Установите переменную окружения с действующим токеном:
   ```bash
   export KINOPOISK_API_KEY="<ваш_токен>"
   ```
2. Выполните команду, чтобы запросить несколько фильмов (по ID, ссылке или названию):
   ```bash
   python -m movie_lottery.utils.kinopoisk 301 "https://www.kinopoisk.ru/film/435/" "Интерстеллар"
   ```

В ответе вы увидите JSON с основными данными фильма, что подтверждает успешное соединение с API. Если токен отсутствует или истек, утилита выведет сообщение об ошибке и завершится с ненулевым кодом.
