// F:\GPT\movie-lottery V2\movie_lottery\static\js\components\modal.js

import { initSlider } from './slider.js';
import { saveMagnetLink } from '../api/movies.js';
import { deleteTorrentFromClient } from '../api/torrents.js';

// --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ ---

function escapeHtml(value) {
    if (value === null || value === undefined) return '';
    return String(value)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
}

const placeholderPoster = 'https://via.placeholder.com/200x300.png?text=No+Image';

/**
 * –°–æ–∑–¥–∞–µ—Ç HTML-—Ä–∞–∑–º–µ—Ç–∫—É –¥–ª—è —Å–ø–∏—Å–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ª–æ—Ç–µ—Ä–µ–∏.
 * @param {Array<object>} movies - –ú–∞—Å—Å–∏–≤ —Ñ–∏–ª—å–º–æ–≤-—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.
 * @param {string|null} winnerName - –ò–º—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è.
 * @returns {string} - HTML-—Å—Ç—Ä–æ–∫–∞.
 */
function createParticipantsHTML(movies, winnerName) {
    if (!movies || movies.length === 0) return '';
    
    const itemsHTML = movies.map(movie => {
        const isWinner = movie.name === winnerName;
        return `
            <li class="participant-item ${isWinner ? 'winner' : ''}">
                <img class="participant-poster" src="${escapeHtml(movie.poster || placeholderPoster)}" alt="${escapeHtml(movie.name)}">
                <span class="participant-name">${escapeHtml(movie.name)}</span>
                <span class="participant-meta">${escapeHtml(movie.year || '')}</span>
                ${isWinner ? '<span class="participant-winner-badge">–ü–æ–±–µ–¥–∏—Ç–µ–ª—å</span>' : ''}
            </li>`;
    }).join('');

    return `
        <div id="modal-participants">
            <h3>–£—á–∞—Å—Ç–Ω–∏–∫–∏ –ª–æ—Ç–µ—Ä–µ–∏</h3>
            <ul class="participants-list">${itemsHTML}</ul>
        </div>`;
}

/**
 * –°–æ–∑–¥–∞–µ—Ç HTML-—Ä–∞–∑–º–µ—Ç–∫—É –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –∏–ª–∏ —Ñ–∏–ª—å–º–∞ –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.
 * @param {object} movieData - –î–∞–Ω–Ω—ã–µ –æ —Ñ–∏–ª—å–º–µ.
 * @param {object} actions - –§—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ –¥–ª—è –∫–Ω–æ–ø–æ–∫.
 * @returns {string} - HTML-—Å—Ç—Ä–æ–∫–∞.
 */
function createWinnerCardHTML(movieData, isLibrary) {
    const ratingValue = parseFloat(movieData.rating_kp);
    let ratingBadge = '';
    if (!isNaN(ratingValue)) {
        const ratingClass = ratingValue >= 7 ? 'rating-high' : ratingValue >= 5 ? 'rating-medium' : 'low';
        ratingBadge = `<div class="rating-badge rating-${ratingClass}">${ratingValue.toFixed(1)}</div>`;
    }

    // –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –Ω–µ–µ
    const libraryButtonHTML = isLibrary
        ? `<button class="danger-button modal-delete-btn">–£–¥–∞–ª–∏—Ç—å –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏</button>`
        : `<button class="secondary-button add-library-modal-btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É</button>`;

    // –°–µ–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ –±–µ–π–¥–∂–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏)
    const badgeIcons = {
        'favorite': '‚≠ê',
        'watchlist': 'üëÅÔ∏è',
        'top': 'üèÜ',
        'watched': '‚úÖ',
        'new': 'üî•'
    };
    
    const badgeLabels = {
        'favorite': '–õ—é–±–∏–º–æ–µ',
        'watchlist': '–•–æ—á—É –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å',
        'top': '–¢–æ–ø',
        'watched': '–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ',
        'new': '–ù–æ–≤–∏–Ω–∫–∞'
    };
    
    const badgeTypes = ['favorite', 'watchlist', 'top', 'watched', 'new'];
    const currentBadge = movieData.badge || null;

    const badgeSectionHTML = isLibrary ? `
        <div class="movie-badge-section">
            <h4>–ë–µ–π–¥–∂ —Ñ–∏–ª—å–º–∞</h4>
            <div class="badge-options-inline">
                ${badgeTypes.map(type => `
                    <div class="badge-option-inline ${currentBadge === type ? 'selected' : ''}" data-badge="${type}">
                        <span class="badge-icon">${badgeIcons[type]}</span>
                        <span class="badge-label">${badgeLabels[type]}</span>
                    </div>
                `).join('')}
            </div>
            ${currentBadge ? '<button class="secondary-button modal-remove-badge-btn" style="margin-top: 10px;">–£–±—Ä–∞—Ç—å –±–µ–π–¥–∂</button>' : ''}
        </div>
    ` : '';

    return `
        <div class="winner-card">
            <div class="winner-poster">
                <img src="${escapeHtml(movieData.poster || placeholderPoster)}" alt="–ü–æ—Å—Ç–µ—Ä ${escapeHtml(movieData.name)}">
                ${ratingBadge}
            </div>
            <div class="winner-details">
                <h2>${escapeHtml(movieData.name)}${movieData.year ? ` (${escapeHtml(movieData.year)})` : ''}</h2>
                <p class="meta-info">${escapeHtml(movieData.genres || '–Ω/–¥')} / ${escapeHtml(movieData.countries || '–Ω/–¥')}</p>
                <p class="description">${escapeHtml(movieData.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.')}</p>
                
                ${movieData.kinopoisk_id ? `
                    <div class="magnet-form">
                        <label for="magnet-input">Magnet-—Å—Å—ã–ª–∫–∞:</label>
                        <input type="text" id="magnet-input" value="${escapeHtml(movieData.magnet_link || '')}" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ magnet-—Å—Å—ã–ª–∫—É...">
                        <div class="magnet-actions">
                            <button class="action-button save-magnet-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            ${movieData.has_magnet ? '<button class="action-button-delete delete-magnet-btn">–£–¥–∞–ª–∏—Ç—å</button>' : ''}
                            <button class="action-button-rutracker search-rutracker-btn" title="–ù–∞–π—Ç–∏ –Ω–∞ RuTracker">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <path d="m21 21-4.35-4.35"></path>
                                </svg>
                                RuTracker
                            </button>
                        </div>
                    </div>` : '<p class="meta-info">Kinopoisk ID –Ω–µ —É–∫–∞–∑–∞–Ω, —Ä–∞–±–æ—Ç–∞ —Å magnet-—Å—Å—ã–ª–∫–æ–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.</p>'}
                
                ${badgeSectionHTML}
                
                <div class="library-modal-actions">
                    <button class="secondary-button modal-download-btn"${movieData.has_magnet ? '' : ' disabled'}>–°–∫–∞—á–∞—Ç—å</button>
                    ${libraryButtonHTML}
                </div>

                <div class="slide-to-delete-container ${movieData.is_on_client ? '' : 'disabled'}" data-torrent-hash="${escapeHtml(movieData.torrent_hash || '')}">
                    <div class="slide-to-delete-track">
                        <div class="slide-to-delete-fill"></div>
                        <span class="slide-to-delete-text">–£–¥–∞–ª–∏—Ç—å —Å –∫–ª–∏–µ–Ω—Ç–∞</span>
                        <div class="slide-to-delete-thumb">&gt;</div>
                    </div>
                </div>
            </div>
        </div>`;
}


// --- –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º ---

export class ModalManager {
    constructor(modalElement) {
        this.modal = modalElement;
        this.body = this.modal.querySelector('.modal-content > div'); // –ü–µ—Ä–≤—ã–π div –≤–Ω—É—Ç—Ä–∏ .modal-content
        this.closeButton = this.modal.querySelector('.close-button');
        
        this.close = this.close.bind(this);
        this.handleOutsideClick = this.handleOutsideClick.bind(this);
        
        this.closeButton.addEventListener('click', this.close);
        this.modal.addEventListener('click', this.handleOutsideClick);
    }
    
    open() {
        this.modal.style.display = 'flex';
        document.body.classList.add('no-scroll');
        this.body.innerHTML = '<div class="loader"></div>';
    }

    close() {
        this.modal.style.display = 'none';
        document.body.classList.remove('no-scroll');
        this.body.innerHTML = '';
    }

    handleOutsideClick(event) {
        if (event.target === this.modal) {
            this.close();
        }
    }

    renderCustomContent(htmlContent) {
        this.body.innerHTML = htmlContent;
    }
    
    renderError(message) {
        this.body.innerHTML = `<p class="error-message">${escapeHtml(message)}</p>`;
    }

    /**
     * –†–µ–Ω–¥–µ—Ä–∏—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –æ–∂–∏–¥–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ª–æ—Ç–µ—Ä–µ–∏.
     * @param {object} lotteryData - –î–∞–Ω–Ω—ã–µ –ª–æ—Ç–µ—Ä–µ–∏.
     */
    renderWaitingModal(lotteryData = {}) {
        const playUrl = lotteryData.play_url || '';
        const telegramShareUrl = lotteryData.telegram_share_url || (playUrl
            ? `https://t.me/share/url?url=${encodeURIComponent(playUrl)}&text=${encodeURIComponent('–ü–æ—Å–º–æ—Ç—Ä–∏ —Ä–æ–∑—ã–≥—Ä—ã—à —Ñ–∏–ª—å–º–∞!')}`
            : '');

        this.body.innerHTML = `
            <div class="waiting-modal">
                <h2>–†–æ–∑—ã–≥—Ä—ã—à –µ—â–µ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω</h2>
                <p class="waiting-status">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–∑–∂–µ.</p>
                ${playUrl ? `
                    <div class="waiting-link-block">
                        <label for="waiting-play-url">–°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–æ–∑—ã–≥—Ä—ã—à:</label>
                        <div class="waiting-link-row">
                            <input type="text" id="waiting-play-url" class="waiting-play-url" value="${escapeHtml(playUrl)}" readonly>
                            <button type="button" class="action-button waiting-copy-btn">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                        </div>
                        <button type="button" class="secondary-button waiting-share-btn" data-share-url="${escapeHtml(telegramShareUrl)}"${telegramShareUrl ? '' : ' disabled'}>–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≤ Telegram</button>
                    </div>
                ` : '<p class="waiting-status">–°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–æ–∑—ã–≥—Ä—ã—à –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.</p>'}
            </div>
        `;

        if (playUrl) {
            this.initializeWaitingActions(playUrl, telegramShareUrl);
        }
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ –æ–∂–∏–¥–∞–Ω–∏—è.
     * @param {string} playUrl - –°—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–æ–∑—ã–≥—Ä—ã—à–∞.
     * @param {string} telegramShareUrl - –°—Å—ã–ª–∫–∞ –¥–ª—è –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –≤ Telegram.
     */
    initializeWaitingActions(playUrl, telegramShareUrl) {
        const copyBtn = this.body.querySelector('.waiting-copy-btn');
        if (copyBtn) {
            copyBtn.addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText(playUrl);
                    if (typeof showToast === 'function') {
                        showToast('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞.', 'success');
                    }
                } catch (error) {
                    const input = this.body.querySelector('#waiting-play-url');
                    if (input && typeof input.select === 'function') {
                        input.select();
                        if (typeof document.execCommand === 'function') {
                            document.execCommand('copy');
                        }
                    }
                    if (typeof showToast === 'function') {
                        showToast('–ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ–µ –≤—Ä—É—á–Ω—É—é.', 'error');
                    }
                }
            });
        }

        const shareBtn = this.body.querySelector('.waiting-share-btn');
        if (shareBtn && telegramShareUrl) {
            shareBtn.addEventListener('click', (event) => {
                event.preventDefault();
                window.open(telegramShareUrl, '_blank', 'noopener');
                if (typeof showToast === 'function') {
                    showToast('–û—Ç–∫—Ä—ã–ª–æ—Å—å –æ–∫–Ω–æ Telegram –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—Å—ã–ª–∫–∏.', 'info');
                }
            });
        }
    }

    /**
     * –†–µ–Ω–¥–µ—Ä–∏—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ò—Å—Ç–æ—Ä–∏–∏.
     * @param {object} lotteryData - –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –ª–æ—Ç–µ—Ä–µ–µ.
     * @param {object} actions - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π.
     */
    renderHistoryModal(lotteryData, actions) {
        const winnerHTML = createWinnerCardHTML(lotteryData.result, false);
        const participantsHTML = createParticipantsHTML(lotteryData.movies, lotteryData.result.name);
        this.body.innerHTML = winnerHTML + participantsHTML;
        this.attachEventListeners(lotteryData.result, actions);
    }
    
    /**
     * –†–µ–Ω–¥–µ—Ä–∏—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏.
     * @param {object} movieData - –î–∞–Ω–Ω—ã–µ –æ —Ñ–∏–ª—å–º–µ.
     * @param {object} actions - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π.
     */
    renderLibraryModal(movieData, actions) {
        this.body.innerHTML = createWinnerCardHTML(movieData, true);
        this.attachEventListeners(movieData, actions);
    }

    /**
     * –ù–∞–≤–µ—à–∏–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –Ω–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞.
     * @param {object} movieData - –î–∞–Ω–Ω—ã–µ –æ —Ñ–∏–ª—å–º–µ.
     * @param {object} actions - –û–±—ä–µ–∫—Ç —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏.
     */
    attachEventListeners(movieData, actions) {
        // –ö–Ω–æ–ø–∫–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å magnet"
        const saveMagnetBtn = this.body.querySelector('.save-magnet-btn');
        if (saveMagnetBtn) {
            saveMagnetBtn.addEventListener('click', () => {
                const input = this.body.querySelector('#magnet-input');
                actions.onSaveMagnet(movieData.kinopoisk_id, input.value.trim());
            });
        }

        // –ö–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å magnet"
        const deleteMagnetBtn = this.body.querySelector('.delete-magnet-btn');
        if (deleteMagnetBtn) {
            deleteMagnetBtn.addEventListener('click', () => actions.onSaveMagnet(movieData.kinopoisk_id, ''));
        }

        // –ö–Ω–æ–ø–∫–∞ "–ù–∞–π—Ç–∏ –Ω–∞ RuTracker"
        const searchRutrackerBtn = this.body.querySelector('.search-rutracker-btn');
        if (searchRutrackerBtn) {
            searchRutrackerBtn.addEventListener('click', () => {
                // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å: "–ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ–¥"
                const searchQuery = `${movieData.name}${movieData.year ? ' ' + movieData.year : ''}`;
                
                // –ö–æ–¥–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –¥–ª—è URL
                const encodedQuery = encodeURIComponent(searchQuery);
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º URL RuTracker (–∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–µ—Ä–∫–∞–ª)
                const rutrackerUrls = [
                    `https://rutracker.org/forum/tracker.php?nm=${encodedQuery}`,
                    `https://rutracker.net/forum/tracker.php?nm=${encodedQuery}`
                ];
                
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–µ—Ä–≤–æ–µ –∑–µ—Ä–∫–∞–ª–æ –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
                window.open(rutrackerUrls[0], '_blank');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                if (window.showToast) {
                    window.showToast(`–û—Ç–∫—Ä—ã—Ç –ø–æ–∏—Å–∫ –Ω–∞ RuTracker: "${searchQuery}"`, 'info');
                }
            });
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–π–¥–∂–∞–º–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏)
        const badgeOptions = this.body.querySelectorAll('.badge-option-inline');
        if (badgeOptions.length > 0 && actions.onSetBadge) {
            badgeOptions.forEach(option => {
                option.addEventListener('click', async () => {
                    const badgeType = option.dataset.badge;
                    await actions.onSetBadge(movieData.id, badgeType);
                });
            });
        }

        const removeBadgeBtn = this.body.querySelector('.modal-remove-badge-btn');
        if (removeBadgeBtn && actions.onRemoveBadge) {
            removeBadgeBtn.addEventListener('click', async () => {
                await actions.onRemoveBadge(movieData.id);
            });
        }

        // –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å/–£–¥–∞–ª–∏—Ç—å –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏"
        const addLibraryBtn = this.body.querySelector('.add-library-modal-btn');
        if (addLibraryBtn) {
            addLibraryBtn.addEventListener('click', () => actions.onAddToLibrary(movieData));
        }
        const deleteLibraryBtn = this.body.querySelector('.modal-delete-btn');
        if (deleteLibraryBtn) {
            deleteLibraryBtn.addEventListener('click', actions.onDeleteFromLibrary);
        }
        
        // –ö–Ω–æ–ø–∫–∞ "–°–∫–∞—á–∞—Ç—å"
        const downloadBtn = this.body.querySelector('.modal-download-btn');
        if (downloadBtn && !downloadBtn.disabled) {
            downloadBtn.addEventListener('click', actions.onDownload);
        }

        // –°–ª–∞–π–¥–µ—Ä
        const slider = this.body.querySelector('.slide-to-delete-container');
        if (slider && !slider.classList.contains('disabled')) {
            initSlider(slider, () => {
                actions.onDeleteTorrent(slider.dataset.torrentHash);
            });
        }
    }
}